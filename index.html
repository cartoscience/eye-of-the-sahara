<!DOCTYPE html>
<html>

<head>
    <title>eye-of-the-sahara</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
	
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.2/gh-fork-ribbon.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
  integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
  crossorigin=""/>
  
  <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
  integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
  crossorigin=""></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
  <script src="//d3js.org/d3.v4.min.js"></script>
  <script src="//npmcdn.com/geotiff@0.3.6/dist/geotiff.js"></script>
  <script src="https://ihcantabria.github.io/Leaflet.CanvasLayer.Field/dist/leaflet.canvaslayer.field.js"></script>
	
  <style>
  body { margin:0; padding:0; }
  #map { position: absolute; top:0; bottom:0; right:0; left:0; }  
  .github-fork-ribbon.right-top:before { background-color: #454545; }
  .github-fork-ribbon.right-top:after { color: #dbdbdb; border-width: 0; text-shadow: 0 -.00em rgba(0, 0, 0, 0.5); }  
  </style>
	
</head>

<body>
  <div id="map"></div>
  <a class="github-fork-ribbon right-top" href="https://cartoscience.com" data-ribbon="cartoscience.com" title="cartoscience.com">cartoscience.com</a>
  <script>
  
  var map = L.map('map', {scrollWheelZoom: true});
  
  var controlLayers = L.control.layers( null, null, {position: "topleft"}).addTo(map);
	  
  var esri = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Imagery tiles: &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
  	minZoom: 2,
	maxZoom: 14
  }).addTo(map);
	    
  d3.request("./eos_dem_4326.tiff").responseType('arraybuffer').get(
      function (error, tiffData) {
      		let dem = L.ScalarField.fromGeoTIFF(tiffData.response);
		let layerD = L.canvasLayer.scalarField(dem).addTo(map);
	      	layerD.setColor(chroma.scale(['#fafa6e','#2A4858'])); 
	        controlLayers.addOverlay(layerD, 'DEM');
                layerD.on('click', function (e) {
                    if (e.value !== null) {
                        let v = e.value;
                        let html = (`<span class="popupText">Elevation: ${v} m</span>`);
                        let popup = L.popup()
                            .setLatLng(e.latlng)
                            .setContent(html)
                            .openOn(map);
                    }
		});
      });
  
  map.attributionControl.addAttribution('Elevation: NASA JPL <a href="https://www2.jpl.nasa.gov/srtm/">SRTM</a>');  
  map.attributionControl.addAttribution('Map design by Brad G. Peter, &copy <a href="https://cartoscience.com/multiscalar-decision-support">CartoScience</a>, <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> &mdash; Map and manuscript (Peter et al. 2018) published by &copy <a href="https://www.tandfonline.com/doi/abs/10.1080/24694452.2017.1403877">AAG</a>');
	  
  </script>
	
</body>
	
</html>
